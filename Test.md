# 最終レポート

#### 19班
##### 1月 日提出
## はじめに
本レポートでは、「スーパーなどで店員の代わりに商品を検索、または店舗自体を検索するシステム」の開発について述べる。本システムでは、音声入力によって「安さ、品質、コスパの何を重視するか」の情報を認識し、対話の最終段階で一番希望にあった店舗と商品の位置を返す機能を実装することを目的とする。
また設計した対話システムに対し、他者によるシステムテストを実施し、想定どうりに情報種等ができるか検証を行う。

## 課題概要

課題として、音声入力によって商品検索を行うための対話フローを作成し、最終確認を音声で行うシステムを構築する。
実装内容は以下のとおりである：

| 項目 | 内容 |
|---|---|
| 対話目的 | ニーズにあった店舗での商品検索 |
| 認識項目 | 安さ、品質、コスパのどれを重視するか |
| 動作 | 音声入力 → 対話フロー → 店舗の候補を上げる → 商品棚検索 |

## シナリオの作成

### シナリオ分析

#### シナリオの収集
1. 店舗検索か商品棚検索かをユーザに問うパターン  
最初に店舗検索を行うか、商品棚の検索を行うか聞く。

(S)何をお求めですか？  
(U)〜を探しています  
(S)店舗検索を行いますか？  
(U)はい  
(S)安さを優先する場合、ダイソーが1番おすすめです  
(S)店舗はダイソーでよろしいですか？  
(U)はい  
(S)商品棚検索を行いますか？  
(U)はい  
(S)商品棚は〜です  
(S)他にお探しの商品はございますか？  
(U)いいえ  
(S)ご利用ありがとうございました  

(S)何をお求めですか？  
(U)〜を探しています  
(S)店舗検索を行いますか？  
(U)いいえ  
商品棚検索に推移  
(S)どの店舗で買い物しますか？  
(U)〜に行きます  
(S)商品棚は〜です  
(S)他にお探しの商品はございますか？  
(U)いいえ  
(S)ご利用ありがとうございました  


2. ユーザの返答から自動的に店舗検索か商品棚検索かを判別するパターン  
店舗名が含まれていれば、商品棚検索を行う。店舗名が含まれていなければ店舗の提示を行い、その後商品棚検索を行う。

(S)何をお求めですか？  
(U)<工具>を探しています  
(S)安さを優先する場合、ダイソーが1番おすすめです  
(S)店舗はダイソーでよろしいですか？  
(U)はい  
(S)商品棚検索を行いますか？  
(U)はい  
(S)商品棚は〜です  
(S)他にお探しの商品はございますか？  
(U)いいえ  
(S)ご利用ありがとうございました  

(S)何をお求めですか？  
(U)<ダイソー> で <工具> を探しています。  
(S)商品棚は<Aの61> です  
(S)他にお探しの商品はございますか？  
(U)いいえ  
(S)ご利用ありがとうございました  

3. どのようなお店を探しているか先にユーザに問うパターン

(S)何をお求めですか？  
(U)<工具>を探しています  
(S)店舗検索を行いますか？  
(U)はい  
(S)どのような店舗をお探しですか？  
(U)<品質重視>な店を探しています  
(S)<品質重視>を優先する場合、<コーナン>が1番おすすめです  
(S)店舗は<コーナン>でよろしいですか  
(U)はい  
(S)商品棚検索を行いますか？  
(U)はい  
(S)商品棚は〜です  
(S)他にお探しの商品はございますか？  
(U)いいえ  
(S)ご利用ありがとうございました  

#### 評価基準とそれぞれに準じた5段階評価

1. 会話の長さ
2. 必要な情報が取得できるか
3. 訂正や変更に対応できるか
4. 会話として自然であるか
5. ユーザの入力にどのくらい対応できるか

#### シナリオの候補の分析結果

| No. | シナリオの概要 | 1.長さ | 2.情報取得 | 3.訂正対応 | 4.自然さ | 5.入力対応 | 合計 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 検索内容確認 | 2 | 5 | 2 | 2 | 2 | 13 |
| 2 | 自動判別 | 4 | 4 | 3 | 5 | 5 | 21 |
| 3 | 条件確認 | 3 | 5 | 5 | 4 | 4 | 21 |

シナリオ1は一つ一つ確認を行うため情報の取得漏れはないが、会話のテンポが悪く、効率性と自然さの項目で低い評価となった。シナリオ2は入力対応や自然さで高評価だが、安さ優先などのデフォルトの推測が外れた場合、後から店舗を変更する手間が発生するため、訂正対応の評価が下がった。シナリオ3は最初に条件を聞く分、シナリオ2より会話の手数はわずかに増える。しかし、ユーザの要望を確実に汲み取ってから提案を行うため、情報の取得や訂正対応で評価が高くなった。

### シナリオのテキスト

(S)何をお求めですか？
(U)<工具>を探しています
(S)どのような店舗をお探しですか？
(U)<品質重視>な店を探しています
(S)<品質重視>を優先する場合、<コーナン>が1番おすすめです
(S)店舗は<コーナン>でよろしいですか
(U)はい
(S)商品棚検索を行いますか？
(U)はい
(S)商品棚は〜です
(S)他にお探しの商品はございますか？
(U)いいえ
(S)ご利用ありがとうございました

### ラベル化と言い回し

#### ラベルの付与

| ラベル | テキスト |
| :--- | :--- |
| **商品の質問/応答** | ① (S) 何をお求めですか？ <br> ② (U) <工具>を探しています |
| **店舗条件の質問/応答** | ③ (S) どのような店舗をお探しですか？ <br> ④ (U) <品質重視>な店を探しています |
| **店舗の提案/確認** | ⑤ (S) <品質重視>を優先する場合、<コーナン>が1番おすすめです。店舗は<コーナン>でよろしいですか？ <br> ⑥ (U) はい |
| **商品棚検索の確認** | ⑦ (S) 商品棚検索を行いますか？ <br> ⑧ (U) はい |
| **商品棚の案内** | ⑨ (S) 商品棚は〜です |
| **追加検索の確認** | ⑩ (S) 他にお探しの商品はございますか？ <br> ⑪ (U) いいえ |
| **終了の挨拶** | ⑫ (S) ご利用ありがとうございました |

#### 言い回し

**(ア) 商品の聞き取り**

①何をお求めですか？
1. <工具>
2. <工具>を探しています
3. <工具>が欲しい

②何かお探しですか？
1. <工具>ある？
2. <工具>を買いたいんだけど

③いらっしゃいませ、ご用件をお伺いします
1. <工具>の売り場を知りたい

**(イ) 店舗条件の聞き取り**

①どのような店舗をお探しですか？
1. <品質重視>な店
2. <品質重視>なところ

②店舗のご希望はありますか？
1. 特にない
2. <安い>店がいい

③何かこだわりはありますか？
1. <一番近い>店

**(ウ) 店舗の提案と確認**

①<品質重視>なら、<コーナン>がおすすめです。<コーナン>でよろしいですか？
1. はい
2. うん
3. お願いします
4. いや、別の店がいい

②<コーナン>はいかがですか？
1. いいよ
2. <コーナン>は嫌だ

**(エ) 商品棚検索の確認**

①商品棚検索を行いますか？
1. はい
2. お願い

②詳しい場所をご案内しましょうか？
1. うん、頼む
2. 大丈夫（検索しない）

**(オ) 追加検索の確認**

①他にお探しの商品はございますか？
1. いいえ
2. ないです
3. 大丈夫
4. あります

②他には？
1. もうないよ
2. 実は<電池>も探してて

**(カ) 終了の挨拶**

①ご利用ありがとうございました

②お気をつけて行ってらっしゃいませ

## 対話フローの作成

### フローの設計

### Intents
|Intent|Slots|
|:---|:---|
|goods|foods<br>appliance<br>daily_necessities|
|response|yes<br>no|
|shops|donkihote<br>seveneleven<br>seijoisi<br>gyomusupa<br>depatika|
|target|price<br>quality<br>Costperformance|

### Entities
今回は利用しなかった

## 対話フローのテスト

本章では、作成した商品検索支援ボットの対話フローに対して、単体テスト・連結テスト・音声認識テストを実施した結果について示す。  
本システムでは、商品カテゴリの判定に加え、`response` Intent に含まれる Slot（yes / no）を用いた確認処理が、  
各段階で正しく制御され、最終的に商品棚案内と対話終了まで到達できるかが重要となる。

### 各ノードの単体テスト

単体テストでは、各ノードが仕様通りに動作するかを確認した。  
特に、以下の質問ノードおよび終了ノードにおける Intent / Slot 抽出と遷移処理に着目してテストを行った。

- 「何をお求めですか？」
- 「店舗の検索を行いますか？」
- 「どのような条件でソートしますか（安さ・品質・コスパ）」
- 「この店舗でいいですか？」
- 「商品棚検索を行いますか？」

#### テスト仕様書

| No | システムの質問 | 入力例 | Intent / Slot | 想定される遷移 |
|---|---|---|---|---|
| 1 | 何をお求めですか？ | グラタン | goods | 店舗検索確認ノード |
| 2 | 店舗の検索を行いますか？ | はい | response / yes | ソート条件選択ノード |
| 3 | どのような条件でソートしますか？ | 品質 | sort | 店舗提示ノード |
| 4 | この店舗でいいですか？ | はい | response / yes | 商品棚検索確認ノード |
| 5 | 商品棚検索を行いますか？ | はい | response / yes | 商品棚案内ノード |
| 6 | 商品棚案内 | ― | ― | 終了ノード |

#### 結果

すべてのノードにおいて、Intent および Slot が正しく認識され、  
最終的に商品棚案内ノードへ遷移し、対話が正常に終了することを確認した。

---　

### フローに基づく連結テスト

連結テストでは、商品検索開始から対話終了までの一連の流れが  
設計通りに動作するかを検証した。

#### テスト仕様

**対話例(店舗検索を行う場合）**

| 発話者 | 内容 |
|---|---|
| Bot | 何をお求めですか？ |
| User | グラタン |
| Bot | 店舗の検索を行いますか？ |
| User | はい |
| Bot | どのような条件でソートしますか（安さ・品質・コスパ） |
| User | 品質 |
| Bot | デパ地下 |
| Bot | この店舗でいいですか？ |
| User | はい |
| Bot | 商品棚検索を行いますか？ |
| User | はい |
| Bot | 3番の棚にございます |
| Bot | ご利用ありがとうございました |

  #### 期待される動作

- 条件に合致した店舗が選択される  
- 商品の陳列棚番号が提示される  
- 案内完了後、対話が終了する

| 確認項目 | 結果 |
|---|---|
| 商品カテゴリ判定 | 成功 |
| 店舗検索確認 | 成功 |
| ソート条件処理 | 成功 |
| 店舗確定 | 成功 |
| 商品棚案内 | 成功 |
| 対話終了 | 成功 |

以上より、本システムは段階的な確認を経て、  
商品棚案内および対話終了までを一貫して実行できることが確認できた。

**対話例(店舗検索を行わない場合）**

| 発話者 | 内容 |
|---|---|
| Bot | 何をお求めですか？ |
| User | グラタン |
| Bot | 店舗の検索を行いますか？ |
| User | いいえ |
| Bot | どこのお店に向かいますか？ |
| User | デパ地下 |
| Bot | 何番の棚にございます。 |
| Bot | ご利用ありがとうございました。 |


#### 期待される動作

- 店舗検索フローを経由せず、ユーザ指定の店舗に基づいて処理が進行する  
- 指定された店舗における商品棚案内が行われる  
- 案内完了後、対話が正常に終了する  

| 確認項目 | 結果 |
|---|---|
| response Intent（no）の認識 | 成功 |
| 代替質問ノードへの遷移 | 成功 |
| 店舗名の取得 | 成功 |
| 商品棚案内 | 成功 |
| 対話終了 | 成功 |

以上より、本システムはユーザが店舗検索を行わない場合においても、  
直接店舗を指定することで商品棚案内および対話終了まで  
適切に処理できることが確認できた。

---

## 音声対話のテスト　
　
### テスト概要

音声対話のテストでは、複数回の yes / no 確認を含む対話においても、  
音声入力が正しく Intent / Slot として認識され、  
最終的に商品棚案内と対話終了まで到達できるかを検証した。

### テスト仕様書とその結果


| 発話例 | 想定される Intent / Slot | 結果 |
|---|---|---|
| はい | response / yes | 正しく認識 |
| うん | response / yes | 正しく認識 |
| いいえ | response / no | 正しく認識 |
| 品質 | sort | 正しく認識 |
| はい（棚検索確認） | response / yes | 正しく認識 |

音声入力においても、  
「3番の棚にございます」「ご利用ありがとうございました」という  
終了メッセージまで対話が途切れることなく進行することを確認した。

---



## 考察

### 課題は解けたのか

本実習の課題である「音声入力によって商品検索を行い、最終確認を音声で行う対話システムの構築」について、本システムは達成できたと考えられる。  
ユーザが求めている商品を起点として、店舗検索を行うか否かを確認し、さらに条件（安さ・品質・コスパ）に基づいた店舗提案や商品棚案内までを、段階的な対話によって実現できた。

また、`response` Intent による yes / no の Slot を用いることで、ユーザの意思に応じた分岐処理を明確に行うことができ、  
店舗検索を行う場合・行わない場合の双方に対応した柔軟な対話フローを構築できた点は、課題の要件を満たしているといえる。

---

### 問題点と対策

一方で、本システムにはいくつかの課題も残った。  
まず、ユーザの発話内容が曖昧な場合や、想定していない言い回しが入力された場合には、Intent や Slot の認識精度が低下する可能性がある。  
特に商品名や店舗名については表記揺れが多く、今後は Entity を活用した補完や辞書登録を行うことで、より安定した認識が可能になると考えられる。

また、現在の対話フローでは、途中で条件を変更したい場合や、誤った選択をした際の訂正操作が限定的である。  
この問題に対しては、「戻る」「条件を変更したい」といった Intent を追加することで、よりユーザフレンドリーな対話システムに改善できると考えられる。

---

### この実習で得た知識と技術

本実習を通して、対話システムの設計においては、単に機能を実装するだけでなく、  
ユーザの行動や意思決定の流れを考慮したシナリオ設計が重要であることを学んだ。

特に、Intent・Slot を用いた情報抽出や、yes / no による分岐制御は、  
音声対話における基本的かつ重要な要素であり、実際にテストを行うことでその有効性を理解することができた。  
また、複数のシナリオを比較・評価し、最適な対話フローを選択するプロセスを経験できた点も、大きな学びであった。

---

## まとめ

本レポートでは、スーパーなどでの利用を想定した商品検索ボットの設計および実装について述べた。  
音声入力を用いてユーザの要望を取得し、条件に応じた店舗提案や商品棚案内を行う対話フローを構築した。

テストの結果、店舗検索を行う場合・行わない場合の双方において、  
ユーザの入力に応じた適切な分岐処理と、最終的な案内・対話終了までを安定して実行できることが確認できた。  
今後は、Entity の活用や訂正機能の拡張を行うことで、より実用的で柔軟な対話システムへと発展させることが可能であると考えられる。


## 付録

### 作業日誌

#### 12月10日
前田：ブレインストーミング、テーマの設定  
橋村：ブレインストーミング  
森松：ブレインストーミング、作成物の概要決定  
太田：ブレインストーミング  
永岡：ブレインストーミング  

#### 12月17日
前田：Intentやslotの要素の検討、githubの共有環境構築。シナリオを一部作成  
橋村：休み  
森松：IntentとSlotsの設定、全員で決定したシナリオに対する具体的なフローチャートの作成  
太田：Botpressの設計、構築  
永岡：シナリオ作成、githubの使い方を調べた  

#### 1月14日


### 議事録

#### 12月10日

#### 12月17日
![flow_image](https://github.com/user-attachments/assets/17b6552c-b131-4d9e-9322-25c83388ed88)

#### 1月14日
