<style>
img {
  max-width: 250px !important;
}
</style>

# 音声対話システム シナリオ作成レポート

**提出日：** 2025年12月10日
**学籍番号：** 2312110036
**氏名：** 前田海空斗

---

## 1. はじめに
本レポートでは、最終レポートの基本課題として、Botpressを用いて、アポイントメントの調整を行う対話システムを構築し、その設計、実装、評価をまとめたものである。
本システムの目的は、必要な情報を取り出し、ユーザーとの合意形成をするものとする。

---

## 2. 課題概要
本課題で作成したシステムは、友人との間で、会うアポイントを取るために、日付、曜日、時間、場所を決めるチャットボットである

**要件**
・音声認識項目は日付、曜日、時間、場所である
・日付：システムはユーザに対して日付を尋ね、XX月XX日の形式で認識する。
・曜日：システムはユーザに対してその日の曜日を確認、X曜日の形式で認識する。
・時刻：システムはユーザに対して時刻を尋ね、XX時XX分の形式で認識する
・場所：場所に関しては、適当に30箇所ほど登録する。
・最後に認識項目を確認する

---

## 3. シナリオ
実装の際に必要となる要素と、自然な対話フローを構築するためにシナリオ分析を行い以下に結果と基準となるシナリオを作成した。

### 3.1 シナリオの分析とラベル化
| 話者 | テキスト | ラベル/意図 |
| :--- | :--- | :--- |
| **(U)**| こんにちわ| 挨拶 |
| **(S)** | こんにちわ | 挨拶 |
| **(U)** | 最近元気にしてる？会いたい | アポイントの打診 |
| **(S)** | いつならいい？ | 質問 / 日時 |
| **(U)** |  (例) 9月16日で| 回答 / 日付指定 |
| **(S)** |  ちなみに何曜日| 質問 / 曜日 |
| **(U)** | (例) 火曜日で | 回答 / 曜日指定 |
| **(S)** | 何時なら来れる？ | 質問 / 時間 |
| **(U)** | (例) 19時15分から | 回答 / 時間指定|
| **(S)** | 場所はどこがいいの？ | 質問 / 場所 |
| **(U)** | (例) 大阪 | 回答 / 場所指定|
| **(S)** | 9月19日の火曜日、19時15分に大阪集合はどう？| アポの確認 |
| **(U)** | いいよ | 肯定 |
| **(S)** | OK！じゃまたその時に！| 終了|


---
### 3.2 シナリオの収集
全10パターンの様々な状況に対して、対応できるように全10種類のシナリオパターンを検討した。

**標準順序パターン**: 日付→曜日→時刻→場所の順にスムーズに決まる基本フロー。


**時刻先行パターン**: 時刻のみを先に提示するフロー。

**場所主導パターン**: ユーザが「梅田に行きたい」と場所を先に指定するフロー。


**時間と場所パターン**: 時間と場所のみを提示し、のこりの日付と曜日を質問するフロー

**日付と時間パターン**: 日付と時間のみ提示し、残りの曜日と場所を質問するフロー。

**日付と場所パターン**:　日付と場所のみ提示し、残りの曜日と時間を質問するフロー。


**一括指定パターン**: 「10月1日の19時に梅田で」と全情報を一度に発話するフロー。


**確認から再度予定の調整パターン**最後の確認の際に、違うという意思を伝えると、再度予定を調整でき上書きできる。

**曜日リアクションパターン**: 「金曜日」に対し「華金やな！」と反応するフロー。

**場所リアクションパターン**: 「大阪・梅田・京橋」に対し「近くて助かるわ」と反応するフロー。

### 3.3 評価基準と5段階基準

#### ブレーンストーミングとKJ法を用いた基準策定
まずはいいシステムとは何かについてチーム内でブレインストーミングを行い、その後KJ法を用いて、発案したアイデアの整理を行い5つの評価基準を制定した。
#### ブレインストーミングによるアイデア
以下にブレインストーミングで出たアイデア12個を記載する
|No.|アイデア|
|:---|:---|
|01|最後まで止まらずに予約完了できること|
|02|必要な情報が漏れなく決まる|
|03|エラーが出ても会話が続行できる|
|04|間違った入力をした時に修正ができる|
|05|システムから聞き返して確認してくれる|
|06|少ないやり取りで終わる|
|07|何回も同じことを聞かれない|
|08|入力の手間がかからない|
|09|ロボットっぽくない|
|10|友達とLINEしているような感覚|
|11|好きな順序で答えられる|
|12|想定外の言葉が来てもフリーズしない|

#### KJ法によるグループ分け
**1.完遂性**(No.1,2,3)
目的としてる情報が揃い予約が完了するか。
**2.回復性**(No.4,5,12)
ミスやエラーからのリカバリーがあるか。
**3.効率性**(No.6,7,8)
手短に終わるか。
**4.自然性**(No.9,10)
人間らしい対話ができるか。
**5.柔軟性**(No.11)
入力形式や順序の自由度があるか。

#### 3.5 5つの評価基準の5段階評価の定義
|No.|基準|5点|4点|3点|2点|1点|
|:---|:---|:---|:---|:---|:---|:---|
|1|完遂性|いかなる状況でもスロットが全て埋まる|イレギュラーな質問にも対応可能|標準的な回答で予約完了|イレギュラーに対応できず、手動操作が必要になる|エラーが誤認識により予約ができない|
|2|回復性|自然な誘導で軌道修正できる。|言い直すことで会話を継続できる|自分で考えて言い直すことで会話を継続できる|手間があるが継続できる|最初からやり直しになる。|
|3|効率性|一括入力が可能。最短で予約が完了する。|意識すれば予約がすぐ終わる。|無駄なやり取りがなく完了する。|無駄なやり取りが若干あり完了までに時間がかかる。|完了までにかなり時間がかかる。|
|4|自然性|人間らしいリアクションがある。|自然な日本語で返答可能である。|事務的であるが、違和感なく質問できる。|違和感がある日本語がある|日本語として不自然な応答がある|
|5|柔軟性|ユーザがどのような順番で情報を提示しても対応できる。|決められた順番の中でスキップ可能である。|システムが想定した順であれば問題なく認識する。|まれに認識しないフレーズが存在する|特定のフレーズ以外は認識しない|

#### 3.6 シナリオの評価
|評価項目|標準順序パターン|一括指定パターン|場所主導パターン|
|:---|:---|:---|:---|
|詳細|一番ベーシックなもの|「(例)7月17日の火曜日、19時梅田で」|(例)「梅田いこ」|
|1.完遂性|5|4|3|
|2.回復性|5|2|4|
|3.効率性|3|5|3|
|4.自然性|4|3|4|
|5.柔軟性|3|4|3|
|合計|20|18|17|

#### 3.7 選定結果
今回は、システム側が、主導権を持って一つずつ質問するために完遂性があり、エラーが起きても回復性もあり、迷わずアポイントまで行くことができる**標準順序パターン**を採用した。
逆に**一括指定パターン**や**場所主導パターン**を採用しなかった理由としては、
効率性やなどそれぞれ得意とする分野ある反面、回復性や完遂性に不安が残るため採用しなかった。

#### 3.8 シナリオのテキスト
| 話者 | テキスト |
| :--- | :--- |
| **(U)**| こんにちは|
| **(S)** | 最近元気にしてる？会いたい |
| **(U)** | 会いたい |
| **(S)** | いつならいい？ |
| **(U)** |  (例) 9月16日で|
| **(S)** |  ちなみに何曜日|
| **(U)** | (例) 火曜日で |
| **(S)** | 何時なら来れる？ |
| **(U)** | (例) 19時15分から |
| **(S)** | 場所はどこがいいの？ |
| **(U)** | (例) 大阪 |
| **(S)** | 9月19日の火曜日、19時15分に大阪集合はどう？|
| **(U)** | いいよ |
| **(S)** | OK！じゃまたその時に！|


#### 3.9 言い回し
作成したシナリオに基づき、システムが認識・生成すべきバリエーションを設計する。

#### A. 日時を聞く場面
**発話：** 「いつならいい？」

**想定されるユーザの応答例：**
* 「9月19日で」
* 「8月21日の火曜日」
* 「21日！」
* 「10月18日火曜日、19時から」
* 「12月19日日曜日、20時から京橋」

#### B.時間を決める場面
*「19時30分」
*「19:30」
*「19時半」
*「16:00」


#### C. 場所を決める場面
**基準となる発話：** 「場所はどこがいい？」

**想定されるユーザの応答例：**
* 「難波で」
* 「大阪がいい」
* 「京橋がいい」
* 「和歌山がいい」


---


## 4.　対話フローの作成
フローの設計について、個々のNodeの詳細な設定や、Intents、Entitiesの登録について述べる。
### 4.1　フローの設計
*作成したbotpressの対話フロー全体図を以下に示す。*
![フローの設計](botpress.png)
### 4.2　個々のノードの設定値
主要なノードについて説明する。

#### **check-date：日付確認**
「いつならいい」とユーザーに問いかけ、日付が返ってくるもしくは、日付が会話に既に入っていたら**check-week**に遷移。2回まで「日付だけ教えて」と聞き返し、日付が来なかったら**one-more-time**に遷移し、会話を一から再度始める
。
*以下このNode発話設定*
![フローの設計](4/check-date01.png)
*以下このNodeの遷移設定*
![フローの設計](4/check-date02.png)

#### **check-week:曜日確認**
「ちなみに何曜日」とユーザーに問いかけ、曜日が返ってくるもしくは、曜日が会話に既に入っていたら**check-time**に遷移。2回まで「曜日を教えて〜」と聞き返し、日付が来なかったら**one-more-time**に遷移し、会話を一から再度始める。

*以下このNode発話設定*
![フローの設計](4/check-week01.png)
*以下このNodeの遷移設定*
![フローの設計](4/check-week02.png)

#### **check-time：時間確認**
「何時から来れる？」とユーザーに問いかけ、時間が返ってくるもしくは、時間が会話に既に入っていたら**check-place**に遷移。2回まで「時間を教えて」と聞き返し、日付が来なかったら**one-more-time**に遷移し、会話を一から再度始める。

*以下このNode発話設定*
![フローの設計](4/check-time01.png)
*以下このNodeの遷移設定*
![フローの設計](4/check-time02.png)

#### **check-place：場所の確認**
「場所はどこがいい？」とユーザーに問いかけ、場所が返ってくるもしくは、場所が会話に既に入っていたら **confirmation**に遷移。2回まで「場所だけ教えて」と聞き返し、場所が来なかったら**one-more-time**に遷移し、会話を一から再度始める。
もし大阪や梅田、京橋などの近場を選んだら**near-place**に遷移して、「 近くて助かるわ。ありがと」と返す。

*以下このNode発話設定*
![フローの設計](4/check-place01.png)
*以下このNodeの遷移設定*
![フローの設計](4/check-place02.png)

#### **confirmation：確認**
ユーザーに確認をとるノード。これまでの会話内容を最後「XX月XX日のX曜日、X時XX分にXX集合でどう？」
「はい」の場合は**positive-reply**に遷移、「いいえ」の場合は**negative-reply**に遷移する

*以下このNode発話設定*
![フローの設計](4/confirmation01.png)
*以下このNodeの遷移設定*
![フローの設計](4/confirmation02.png)
*以下このNodeの設定*
![フローの設計](4/confirmation03.png)

### 4.3　 Intents
作成したslotsについて記載する。
Intentsについては、「appointment」、「affermative」、「cancel」、「negative」の四つを作成した。
#### **appointmentインテント：予約**
アポイントを取るためのワードを学習するためのIntentである
Slotsとしては、日付を認識する「date」、時間を認識する「time」、場所を認識する「place」、曜日を認識する「week」、あいたいという意思を認識する「meet」を設定した。

*以下アポイントに関する登録ワード*
![フローの設計](4/appo01.png)
![フローの設計](4/appo02.png)
![フローの設計](4/appo03.png)
![フローの設計](4/appo04.png)
#### **affermativeインテント：ポジティブな返答**
ポジティブな返答を読み取るためのIntent

以下ポジティブな返答に関するワード
*![フローの設計](4/affermative.png)*
#### **negativeインテント：ポジティブな返答**
ネガティブな返答を読み取るためのIntent

*以下ポジティブな返答に関するワード*
![フローの設計](4/negative.png)

#### **cancelインテント：断る時の返答**
断る時の返答を読み取るためのIntent

*以下キャンセルを伝える返答に関するワード*
![フローの設計](4/cancel.png)


### 4.4　Entities
#### **locationのエンティティ：場所の固有名詞の認識**

*以下のようにインテントに約30箇所の場所を登録した。*
![フローの設計](4/location01.png)
![フローの設計](4/location02.png)


##### **time_expr/day_expr/Weekday：時間と日付、曜日を認識するエンティティ**
以下は日付と時間、曜日を認識するエンティティである。
漢数字で読み取ったとしても数字として認識して値を格納できるようにするセクションである。また曜日が入力された時、曜日として格納できるようにもしている。

*以下日付に関するエンティティ「day_expr」*
![フローの設計](4/day.png)
*以下時間に関するエンティティ「time_expr」*
![フローの設計](4/time.png)
*以下曜日に関するエンティティ「Weekday」*
![フローの設計](4/week.png)

---

## 5. 対話フローのテスト
本システムのそれぞれのNodeに対する単体テストとシステム全体に対する連結テストを用いて、ソフトウェアの品質を評価する。
### 5.1 各ノードの単体テスト
各ノードが想定通りの挙動をするの確認したテスト仕様書と結果である。
|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|01|check-date|9月16日|9月16日が格納、check-weekへ遷移|ちなみに何曜日？|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-01-1.png)
![フローの設計](5/5-01.png)


|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|02|check-week|火曜日|火曜日が格納、check-timeへ遷移|何時なら来れる？|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-02.png)
![フローの設計](5/5-02-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|03|check-week|月曜日|月曜日が格納、Mondayを経由してcheck-timeへ遷移|月曜から行くん？いいけど何時なら来れる？|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-03.png)
![フローの設計](5/5-03-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|04|check-week|金曜日|金曜日が格納、Fridayを経由してcheck-timeへ遷移|華金やな！まじ楽しみ|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-04.png)
![フローの設計](5/5-04-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|05|check-week|日曜日|日曜日が格納、Sundayを経由してcheck-timeへ遷移|日曜日どこ行っても混むかな|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-05.png)
![フローの設計](5/5-05-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|06|check-time|19時39分|19時39分が格納、check-placeへ遷移|場所はどこがいいの？|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-06.png)
![フローの設計](5/5-06-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|07|check-place|東京|東京が格納、confirmationへ遷移|予定を確認させて〜|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-07.png)
![フローの設計](5/5-07-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|08|check-place|京橋|京橋が格納、near-placeを経してconfirmationへ遷移|近くて助かるわ。ありがと予定を確認させて〜|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-08.png)
![フローの設計](5/5-08-1.png)

|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|09|confirmation|はい|positive-replyへ遷移|OK！じゃまたその時！|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-09.png)
![フローの設計](5/5-09-1.png)
|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|10|confirmation|いいえ|negative-replyへ遷移|もう一度予定を確認させて|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-10.png)
![フローの設計](5/5-10-1.png)
|No.|テストノード|入力例|内部処理|出力例|結果|
|:---|:---|:---|:---|:---|:---|
|11|cancel|やめる|cancelへ遷移|了解！また予定が合えばどっかいこ|ok|

*以下は実際の対話テスト*
![フローの設計](5/5-11.png)
![フローの設計](5/5-11-1.png)

### 5.2 フローに基づく連結テスト
対話フローの全体をテストする
|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|01|基本フロー|こんにちわ|最近元気している？会いたい|OK|
|||会いたい|いつならいい?|OK|
|||9月19日で|ちなみに何曜日?|OK|
|||火曜日|何時なら来れる?|OK|
|||19時30分|場所はどこがいいの?|OK|
|||和歌山|9月19日の火曜日、19時30分に和歌山集合でどう?|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-1.png)

|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|02|特定場所分岐|こんにちわ|最近元気している？会いたい|OK|
|大阪・梅田・京橋でリアクション|
|||会いたい|いつならいい?|OK|
|||9月19日で|ちなみに何曜日?|OK|
|||火曜日|何時なら来れる?|OK|
|||19時30分|場所はどこがいいの?|OK|
|||大阪で|近くて助かるわ　9月19日の火曜日、19時30分に大阪集合でどう?|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-2.png)
![フローの設計](5.2/5-2-1.png)

|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|03|特定曜日分岐|こんにちわ|最近元気している？会いたい|OK|
|月曜・金曜・日曜でリアクション|
|||会いたい|いつならいい?|OK|
|||9月23日で|ちなみに何曜日?|OK|
|||金曜日|華金やな！まじ楽しみ　何時なら来れる?|OK|
|||19時30分|場所はどこがいいの?|OK|
|||和歌山|9月23日の金曜日、19時30分に和歌山集合でどう?|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-3.png)
![フローの設計](5.2/5-3-1.png)

|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|04|スロット一括入力|こんにちわ|最近元気している？会いたい|OK|
|日付・曜日・時間・場所の質問をスキップ||
|||会いたい|いつならいい?|OK|
|||10月1日水曜日、19時30分に天王寺で|予定を確認させて〜10月1日水曜日、19時30分に天王寺でどう？|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-4.png)

No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|05|時間と場所を一括入力|こんにちわ|最近元気している？会いたい|OK|
|時間と場所だけ読み取り|||
|||会いたい|いつならいい?|OK|
|||9月23日難波で|ちなみに何曜日?|OK|
|||火曜日|何時なら来れる？|OK|
|||19時30分から|予定を確認させて〜9月23日火曜日、19時30分に難波でどう？|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-5.png)


|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|06|日付と時間を一括入力|こんにちわ|最近元気している？会いたい|OK|
|日付と時間だけ読み取り|||
|||会いたい|いつならいい?|OK|
|||9月23日19時30分から|ちなみに何曜日?|OK|
|||火曜日|場所はどこがいいの？|OK|
|||難波で|予定を確認させて〜9月23日火曜日、19時30分に難波でどう？|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-6.png)

|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|07|日付と場所を一括入力|こんにちわ|最近元気している？会いたい|OK|
|日付と場所だけ読み取り|||
|||会いたい|いつならいい?|OK|
|||9月23日に難波で|ちなみに何曜日?|OK|
|||火曜日|何時なら来れる?|OK|
|||19時30分から|予定を確認させて〜9月23日火曜日、19時30分に難波でどう？|OK|
|||いいよ|OK！じゃその時に!|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-7.png)


|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|08|否認フロー|こんにちわ|最近元気している？会いたい|OK|
|||会いたい|いつならいい?|OK|
|||9月23日で|ちなみに何曜日?|OK|
|||金曜日|華金やな！まじ楽しみ　何時なら来れる?|OK|
|||19時30分|場所はどこがいいの?|OK|
|||和歌山|9月23日の金曜日、19時30分に和歌山集合でどう?|OK|
|||いいえ|もう一度予定を確認させて|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-8.png)
![フローの設計](5.2/5-8-1.png)


|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|09|中断フロー|こんにちわ|最近元気している？会いたい|OK|
|||会いたい|いつならいい?|OK|
|||9月23日で|ちなみに何曜日?|OK|
|||火曜日|何時なら来れる?|OK|
|||19時30分で|場所はどこがいいの？|OK|
|||やっぱりやめる|了解！また予定が合えばどっかいこ|OK|
|||キャンセル|了解！また予定が合えばどっかいこ|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-9.png)
![フローの設計](5.2/5-9-1.png)

|No.|テストケース名|入力|想定される出力|結果|
|:---|:---|:---|:---|:---|
|10|聞き返し回数上限|こんにちわ|最近元気している？会いたい|OK|
|※2回まで聞き返す||||||
|||会いたい|いつならいい?|OK|
|||9月23日で|ちなみに何曜日?|OK|
|||あ|曜日を教えて〜|OK|
|||あ|曜日を教えて〜|OK|
|||あ|申し訳ありません。最初から確認したいです!いつならいい？|OK|

*以下は実際の対話テスト*
![フローの設計](5.2/5-10.png)


---

## 6.　音声対話のテスト
本課題のゴールでもある音声対話が正常に動作するか、そして結果から導き出される考察を述べる。

### 6.1　テスト概要
今回のテストで、構築した対話システムに対して実際の「音声」を入力し、システムが正しく音声をテキスト化し、意図（Intent）と情報（Entity）を抽出できるかを確認する

#### 目的：
・音声認識精度の確認：ユーザの発話が正しいテキストに変換させるか
・対話完了の確認：音声入力に対して、システムが適切な音声で応答して、アポイントメント予約が完了するか
#### 環境 :
・デバイス： MacBook Air
・ブラウザ: Google Chrome

### 6.2　テスト仕様書とその結果
本テストで協力していただいた被験者と調査結果及びそこから導き出される考察を述べる。

#### 音声を発する被験者
以下の三名を今回の検証の被験者に選定した。
理由としては、特徴にそれぞればらつきがありより多くのデータが得られると考えたからである。
|仮名|年齢|性別|声の音程|特徴|
|:---|:---|:---|:---|:---|
|Aくん|20代|男性|中|関西弁で元気|
|Bさん|40代|女性|中〜高|落ち着いたトーン|
|Cさん|50代|男性|低め|若干ガラガラ声|

#### テスト結果
全12パターンの音声入力の結果を示す。入力されたテキストからどのようにテキストを認識してスロットに入ったかを記録した。
|No.|被験者|音声|認識テキスト|抽出データ|システム応答|結果|
|:---|:---|:---|:---|:---|:---|:---|
|01|Aくん|なぁなぁ|なぁなぁ||最近元気している？会いたい|OK|
|02|Aくん|会いたい|会いたい||いつならいい?|OK|
|03|Aくん|9月17日|九月十七日|date:9月17日|ちなみに何曜日?|OK|
|04|Bさん|火曜日|火曜日|week:火曜日|何時なら来れる?|OK|
|05|Bさん|19時30分|十九時三十分|time:19時30分|場所はどこがいいの?|OK|
|06|Bさん|和歌山|和歌山|place:和歌山||予定を確認させて　9月17日の火曜日、19時30分に和歌山集合でどう？|OK|
|07|Bさん|はい|はい|affirmative:はい|OK！じゃまたその時！|OK|

以下実際の会話のログ
![会話](6/Test_01.png)
![会話](6/Test_02.png)

|No.|被験者|音声|認識テキスト|抽出データ|システム応答|結果|
|:---|:---|:---|:---|:---|:---|:---|
|08|Cさん|お久しぶりです|お久しぶりです||最近元気している？会いたい|OK|
|09|Cさん|はい|はい||いつならいい|OK|
|10|Cさん|5月4日の水曜日|五月四日の水曜日|date:5月4日 week:水曜日|何時なら来れる?|OK|
|11|Cさん|19時から|十九時から|time:19時から|場所はどこがいいの？|OK|
|12|Cさん|やめる|やめる|cancel:true|了解！また予定が合えばどっかいこ|OK|

以下実際の会話のログ
![会話](6/Test_03.png)
![会話](6/Test_04.png)

#### 結果からの考察
今回の検証結果から、Aくん、Bさん、Cさんの声質によって認識結果にミスが生じることがないことが確認された。このことから、今回使用した音声認識のチャットボットにおいて音声の聞き取りに大きな問題がないことがわかる。また、「5月4日の水曜日」などの二つの要素を入れた長い単語も正常に聞き取ることができた上に、「やめる」といった言葉も認識し、直ちに会話が終了された。このことから複数の要素を持つ文章や、ある単語を認識することで起こる条件分岐も正常に動作していることがわかる。
以上のことより、本システムは話手の年齢や性別に依存することなく、安定して動作することができると判断できる。

---

## 7.　考察
本課題を通じて感じたことや、問題点とその対策、そして得た知識や技術について考察する。
### 7.1　課題は解けたか
**結論**：本課題のユーザーとアポイントを取る音声対話システムを作成し、日時と場所を聞き取り、最後に認識項目をまとめて発話しユーザーに確認し、ユーザーとの合意形成を行うという要件は十分に満たすことができたと考える。
**理由** :まずは、ユーザーが発話した情報を正しく認識・抽出し、最後に情報の整理と意思の確認ができていたことから対話が成立していたと言える。その上、ユーザーが一括して日付・時間・場所の情報を発話した時も正しくスロットが抽出されていることが確認できたためである。
また、特定の場所や曜日に対してのリアクション(「大阪・梅田・京橋」へのリアクションや「金曜日」への反応)も動作していることから、単調な質疑応答ではなく、より人間らしい対話が成立していた点も挙げられる。
このことから情報をフォームに入力する作業ではなく、よりリアルな人間味のある対話が実現でき、今回の対話を通じてユーザとの合意形成を行うという目的は本システムで十分に果たすことができると考える。
**コミュニケーションについて**：システムが投げかける「いつならいい？」という質問に対して、ユーザーの答え方を限定せずに、ユーザーの答え方に合わせて残りの必要な要素を聞くことができることができる。これにより円滑でユーザーに依存しない対話が実現されたと言える。

### 7.2　問題点と対策
本システムが抱える問題点とその対策について以下に述べる。
#### **音声認識の精度**
**問題点**：例えばユーザーが「こんにちわ」と発話した際に、「今日わ」と認識されたり、「わ」としか認識されなかったことがあった。これはチャットボット側の音声認識の精度によるものであると考える。
**対策**：システム側で、意味が通らない言葉が認識された時に再度確認するフローを追加したり、自動で意味の通るひらがなに変換することで解消されると考えられる。
#### **入力情報の修正・訂正フロー**
**問題点**：最後の確認のフローで、現在はNodeのメッセージに「いいえ」と答えると全ての会話がリセットされ、一から問いかけるようになっている。だがそれでは、日付だけ、時間だけ変更したいユーザーにとっては大きな手間になってしまうと考える。
**対策**：確認に「いいえ」と回答した後、ユーザーにどこを変更しますかと聞き返し、特定のスロットのみを上書き更新するフローを追加することで部分修正が可能になり問題が解消できると考える。
#### **日付と曜日の整合性チェック**
**問題点**：日付と曜日を個別のノードで管理しているため、ユーザーが誤って「9月15日火曜日(正しくは水曜日)」と発話してしまってもシステムが気が付かずに、架空の日付曜日のアポイントが完了してしまうという問題があると考える。
**対策**：日付が確定した時点で、正しい曜日を自動で計算して、ユーザーが発話した曜日と照合して、もし不一致の場合は「9月15日は水曜日ですが、9月15日でよろしいですか？」と問いかけるような仕組みを作る必要があると考える。

### 7.3　この実習で得た知識
本実習を通じて以下の技術と知識を得た。

#### **必要なフローの整理・構築する力**
日常の友人とアポイントを取るという何でもないやり取りをシステムに落とし込む過程を通じて、そのフローを整理する力を身につけた。
単にプログラムを組むのではなく、ユーザーにどのような言葉を発言させる必要があるのかを想定し、それをシナリオパターンとして分析・収集する技術を身につけた。

#### **スロットフィリングによる状態管理技術**
対話システムの不可欠なコンテキストの技術を理解した。ユーザーの断片的な発話から「日付」「時間」といった必要な情報を抽出し、それをスロットと呼ばれる変数に保持する仕組みを実装することで、さまざまな対話パターンに対応したシステム設計の構築を学んだ。

#### **システムの評価技術**
今回のレポートの作成における、単体テストや複合テスト、音声テストを通じて、システムにエラーがないかを確認する評価スキルを身につけた。一つにソフトウェアに対して、考えられるパターンを全て列挙しテストすることで、全てのパターンにおいて狙い通りの動作をする質の高いチャットボットを作ることができた。

---

## 8.　まとめ
本レポートは、友人とのアポイント調整を行う音声対話システムの設計から実装、評価までを行った。
本要件に従い、友人とのアポイントを取る際のフローを見直し、10種類以上のシナリオパターンを分析し、自然な対話の流れと例外処理を含む対話フローを設計した。実装においては、Botpressを使用し、日付・曜日・時間・場所の4つの情報をスロットフィリングによって収集する仕組みを構築した。特に、特定の単語を抽出した際に、リアクションをする機能や、ユーザの入力を柔軟に受け入れるインテント設計を行い、対話の質を向上させた。
システムテストでは、異なる声の特徴を持つ被験者による音声入力を行い、順次入力や一括入力など多様なパターンにおいて、システムが正常に情報を抽出して、アポイントが完了できるところまで実証した。一方で、今後の課題として、音声認識の精度や、情報の柔軟な修正が課題として発見された。
結果として、本システムは今回の目的であるユーザとの対話で合意形成を行うという点において十分に要件を満たすものとなっていた。本実習で得た知見は、今後のより自身のキャリアの中で必要になってくるシステムの開発から運用までのフェーズで活かすことができると考えられる。
